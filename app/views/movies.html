<div class="header">
  <ul class="nav nav-pills pull-right">
    <li><a href="#/">Torrents</a></li>
    <li class="active"><a href="#/movies">Movies</a></li>
    <li>
      <a href="https://github.com/asapach/peerflix-server" target="_blank">
        <i class="fa fa-github"></i> About</a>
    </li>
  </ul>
  <h3 class="text-muted text-nowrap"><img src="images/logo.svg" alt="logo" height="40"> peerflix server</h3>
</div>

<!-- Loading indicator -->
<div ng-if="loading" class="text-center">
  <i class="fa fa-spinner fa-spin fa-2x"></i>
  <p>Loading...</p>
</div>

<!-- Success message -->
<div ng-if="success" class="alert alert-success alert-dismissible" role="alert">
  <button type="button" class="close" ng-click="clearMessages()">
    <span aria-hidden="true">&times;</span>
  </button>
  <i class="fa fa-check-circle"></i> {{ success }}
</div>

<!-- Error message -->
<div ng-if="error" class="alert alert-danger alert-dismissible" role="alert">
  <button type="button" class="close" ng-click="clearMessages()">
    <span aria-hidden="true">&times;</span>
  </button>
  <i class="fa fa-exclamation-circle"></i> {{ error }}
</div>

<!-- Header section -->
<div class="jumbotron">
  <h1><i class="fa fa-film"></i> Movie Collection</h1>
  <p>Manage your movie collection and generate M3U playlists for streaming.</p>
  <div class="btn-group" role="group">
    <button class="btn btn-primary" ng-click="showAddForm()" ng-disabled="loading">
      <i class="fa fa-plus"></i> Add Movie
    </button>
    <button class="btn btn-success" ng-click="downloadPlaylist()" ng-disabled="loading || !movies.length">
      <i class="fa fa-download"></i> Download M3U Playlist
    </button>
  </div>
</div>

<!-- Movie form modal -->
<div class="panel panel-default" ng-show="showForm">
  <div class="panel-heading">
    <h4>
      <i class="fa" ng-class="editMode ? 'fa-edit' : 'fa-plus'"></i>
      {{ editMode ? 'Edit Movie' : 'Add New Movie' }}
    </h4>
  </div>
  <div class="panel-body">
    <form name="movieForm" ng-submit="saveMovie()" novalidate>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="movieId">ID *</label>
            <input type="text" 
                   id="movieId" 
                   class="form-control" 
                   ng-model="currentMovie.id" 
                   placeholder="Unique movie ID"
                   ng-disabled="editMode"
                   required>
            <small class="help-block">Unique identifier for the movie (cannot be changed after creation)</small>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="movieName">Name *</label>
            <input type="text" 
                   id="movieName" 
                   class="form-control" 
                   ng-model="currentMovie.name" 
                   placeholder="Movie name"
                   required>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="movieImage">Image URL</label>
        <input type="url" 
               id="movieImage" 
               class="form-control" 
               ng-model="currentMovie.image" 
               placeholder="https://example.com/poster.jpg">
        <small class="help-block">Optional poster/thumbnail image URL</small>
      </div>
      
      <div class="form-group">
        <label for="movieTorrent">Torrent File/Magnet Link *</label>
        <textarea id="movieTorrent" 
                  class="form-control" 
                  rows="3"
                  ng-model="currentMovie.torrentFile" 
                  placeholder="magnet:?xt=urn:btih:... or path to .torrent file"
                  required></textarea>
        <small class="help-block">Magnet link or path to torrent file</small>
      </div>
      
      <div class="form-group">
        <label for="movieFileIndex">File Index *</label>
        <input type="number" 
               id="movieFileIndex" 
               class="form-control" 
               ng-model="currentMovie.fileIndex" 
               min="0"
               placeholder="0"
               required>
        <small class="help-block">Index of the video file in the torrent (usually 0 for single file torrents)</small>
      </div>
      
      <div class="btn-group" role="group">
        <button type="submit" 
                class="btn btn-success" 
                ng-disabled="loading || movieForm.$invalid">
          <i class="fa fa-save"></i> 
          {{ editMode ? 'Update Movie' : 'Add Movie' }}
        </button>
        <button type="button" 
                class="btn btn-default" 
                ng-click="cancelForm()" 
                ng-disabled="loading">
          <i class="fa fa-times"></i> Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Movies list -->
<div ng-if="!movies.length && !loading" class="alert alert-info" role="alert">
  <i class="fa fa-info-circle"></i> No movies found. Add some movies to get started!
</div>

<div class="row content" ng-if="movies.length">
  <div ng-repeat="movie in movies" class="col-md-6 col-lg-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <div class="pull-right">
          <div class="btn-group btn-group-xs" role="group">
            <button type="button" 
                    class="btn btn-default" 
                    ng-click="editMovie(movie)"
                    title="Edit Movie">
              <i class="fa fa-edit"></i>
            </button>
            <button type="button" 
                    class="btn btn-danger" 
                    ng-click="deleteMovie(movie)"
                    title="Delete Movie">
              <i class="fa fa-trash"></i>
            </button>
          </div>
        </div>
        <h4 class="panel-title">
          <i class="fa fa-film"></i> {{ movie.name }}
        </h4>
      </div>
      
      <div class="panel-body">
        <div ng-if="movie.image" class="text-center" style="margin-bottom: 15px;">
          <img ng-src="{{ movie.image }}" 
               alt="{{ movie.name }}" 
               class="img-responsive img-thumbnail"
               style="max-height: 200px; margin: 0 auto;">
        </div>
        
        <div class="movie-info">
          <p><strong>ID:</strong> <code>{{ movie.id }}</code></p>
          <p><strong>File Index:</strong> {{ movie.fileIndex }}</p>
          <p><strong>Torrent:</strong></p>
          <p class="text-muted" style="font-size: 11px; word-break: break-all;">
            {{ movie.torrentFile | limitTo: 100 }}{{ movie.torrentFile.length > 100 ? '...' : '' }}
          </p>
        </div>
      </div>
      
      <div class="panel-footer">
        <div class="btn-group btn-group-sm btn-group-justified" role="group">
          <a ng-href="{{ getStreamUrl(movie) }}" 
             target="_blank" 
             class="btn btn-primary"
             title="Stream Movie">
            <i class="fa fa-play"></i> Stream
          </a>
          <button type="button" 
                  class="btn btn-info"
                  ng-click="editMovie(movie)"
                  title="Edit Movie">
            <i class="fa fa-edit"></i> Edit
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="footer">
  <p><span class="fa fa-heart"></span> peerflix movies</p>
</div>